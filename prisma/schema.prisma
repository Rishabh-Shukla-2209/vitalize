generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum Difficulty {
  BEGINNER
  INTERMEDIATE
  ADVANCED
}

enum ExerciseCategory {
  CARDIO
  STRENGTH
  FLEXIBILITY
  HIIT
  CORE
  BALANCE
  ENDURANCE
  RECOVERY
  MINDBODY
}

enum MuscleGroup {
  CHEST
  BACK
  SHOULDERS
  BICEPS
  TRICEPS
  FOREARMS
  TRAPS
  ROTATOR_CUFF
  ABS
  OBLIQUES
  LOWER_BACK
  LATS
  QUADS
  HAMSTRINGS
  GLUTES
  CALVES
  HIP_FLEXORS
  ADDUCTORS
  ABDUCTORS
  FULL_BODY
}

enum Equipment {
  NONE
  DUMBBELL
  BARBELL
  KETTLEBELL
  RESISTANCE_BAND
  MACHINE
  CABLE
  SMITH_MACHINE
  EZ_BAR
  MEDICINE_BALL
  STABILITY_BALL
  BENCH
  BOX
  JUMP_ROPE
  PULL_UP_BAR
  TRX
  TREADMILL
  BIKE
  ROWING_MACHINE
  ELLIPTICAL
}

enum NotificationType {
  FOLLOW
  LIKE_POST
  LIKE_COMMENT
  COMMENT
}

enum GoalStatus {
  ABANDONED
  IN_PROGRESS
  ACHIEVED
  MISSED

  @@map("Status")
}

enum Privacy {
  PUBLIC
  PRIVATE
}

enum FollowStatus {
  REQUESTED
  ACCEPTED
}

model User {
  id                    String            @id
  createdAt             DateTime          @default(now())
  firstName             String?
  lastName              String?
  email                 String?
  imgUrl                String?
  gender                Gender?
  dateOfBirth           DateTime?
  currentStreakDays     Int               @default(0)
  longestStreakDays     Int               @default(0)
  lastActiveOn          DateTime?
  about                 String?
  bio                   String?
  privacy               Privacy           @default(PUBLIC)
  Follows               Follow[]          @relation("FollowingRelation")
  Following             Follow[]          @relation("FollowerRelation")
  WorkoutPlans          WorkoutPlan[]
  WorkoutLogs           WorkoutLog[]
  ExerciseCatalog       ExerciseCatalog[]
  Posts                 Post[]
  Comments              Comment[]
  Goal                  Goal[]
  NotificationRecipient Notification[]    @relation("RecipientRelation")
  NotificationSender    Notification[]    @relation("SenderRelation")
  AiInteraction         AiInteraction[]
  MeasureMent           Measurement[]

  PR PR[]

  PostLike PostLike[]

  CommentLike CommentLike[]
}

model ExerciseCatalog {
  id           String           @id @default(uuid())
  name         String           @unique
  category     ExerciseCategory
  instructions String
  imgUrl       String?
  createdAt    DateTime         @default(now())
  muscleGroup  MuscleGroup
  equipment    Equipment?
  createdBy    User?            @relation(fields: [createdByid], references: [id])
  createdByid  String?
  ExerciseLogs ExerciseLog[]
  planExercise PlanExercise[]
  Goal         Goal[]

  PR PR[]
}

model WorkoutPlan {
  id          String         @id @default(uuid())
  userId      String?
  createdBy   User?          @relation(fields: [userId], references: [id])
  level       Difficulty
  name        String         @unique
  imgUrl      String?
  description String
  duration    Int
  exercises   PlanExercise[]
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @default(now())
  WorkoutLogs WorkoutLog[]
}

model PlanExercise {
  id            String          @id @default(uuid())
  position      Int
  sets          Int             @default(0)
  reps          Int             @default(0)
  rest          Int             @default(0)
  distance      Float?
  time          Int?
  exercise      ExerciseCatalog @relation(fields: [exerciseid], references: [id])
  exerciseid    String
  WorkoutPlan   WorkoutPlan     @relation(fields: [WorkoutPlanid], references: [id])
  WorkoutPlanid String
  ExerciseLogs  ExerciseLog[]
}

model WorkoutLog {
  id        String        @id @default(uuid())
  user      User          @relation(fields: [userId], references: [id])
  userId    String
  plan      WorkoutPlan   @relation(fields: [planid], references: [id])
  planid    String
  exercises ExerciseLog[]
  duration  Int
  createdAt DateTime
  notes     String?

  Post Post[]
}

model ExerciseLog {
  id                   String          @id @default(uuid())
  exercise             ExerciseCatalog @relation(fields: [exerciseid], references: [id])
  exerciseid           String
  sets                 Int             @default(0)
  reps                 Int             @default(0)
  vol                  Int             @default(0)
  weightUsed           Int             @default(0)
  rest                 Int             @default(0)
  distance             Float           @default(0)
  duration             Int             @default(0)
  heartRate            Int             @default(0)
  speed                Int             @default(0)
  caloriesBurned       Int             @default(0)
  vo2Max               Float           @default(0)
  rpe                  Int             @default(0) //rate of perceived exertion 1-10.
  rangeOfMotion        Float           @default(0)
  staticFlexibility    Float           @default(0)
  dynamicFlexibility   Float           @default(0)
  workIntervalDuration Int             @default(0)
  restIntervalDuration Int             @default(0)
  workToRestRatio      Float           @default(0)
  plankHoldTime        Int             @default(0)
  tug                  Int             @default(0) //Timed up and go test
  timeToExhaustion     Int             @default(0)
  heartRateVariability Int             @default(0)
  createdAt            DateTime        @default(now())
  WorkoutLog           WorkoutLog      @relation(fields: [WorkoutLogid], references: [id], onDelete: Cascade)
  WorkoutLogid         String
  planExercise         PlanExercise[]
}

model Measurement {
  id         String   @id @default(uuid())
  user       User     @relation(fields: [userid], references: [id])
  userid     String
  measuredAt DateTime @default(now())
  height     Int?
  weight     Int
  fatPct     Float?
  notes      String?

  @@unique([userid, measuredAt])
}

model Goal {
  id               String          @id @default(uuid())
  user             User            @relation(fields: [userid], references: [id], onDelete: Cascade)
  userid           String
  title            String
  status           GoalStatus      @default(IN_PROGRESS)
  targetExercise   ExerciseCatalog @relation(fields: [targetExerciseid], references: [id])
  targetExerciseid String
  targetField      String
  targetValue      Float
  initialValue     Float
  currentValue     Float
  targetDate       DateTime
  createdAt        DateTime        @default(now())
}

model PR {
  id         String          @id @default(uuid())
  user       User            @relation(fields: [userid], references: [id])
  userid     String
  exercise   ExerciseCatalog @relation(fields: [exerciseid], references: [id])
  exerciseid String
  prField    String
  prValue    Float
  createdAt  DateTime        @default(now())

  @@unique([userid, exerciseid])
}

model Follow {
  id          String       @id @default(uuid())
  follower    User         @relation("FollowerRelation", fields: [followerId], references: [id])
  followerId  String
  following   User         @relation("FollowingRelation", fields: [followingId], references: [id])
  followingId String
  status      FollowStatus
  createdAt   DateTime     @default(now())

  @@unique([followerId, followingId])
}

model Post {
  id           String         @id @default(uuid())
  user         User           @relation(fields: [userid], references: [id], onDelete: Cascade)
  userid       String
  title        String
  body         String?
  imgUrl       String?
  workoutLog   WorkoutLog?    @relation(fields: [workoutLogid], references: [id])
  workoutLogid String?
  createdAt    DateTime       @default(now())
  privacy      Privacy        @default(PUBLIC)
  PostLike     PostLike[]
  Comment      Comment[]
  Notification Notification[]
}

model Comment {
  id          String        @id @default(uuid())
  user        User          @relation(fields: [userid], references: [id], onDelete: Cascade)
  userid      String
  text        String
  post        Post          @relation(fields: [postid], references: [id])
  postid      String
  parent      Comment?      @relation("replies", fields: [parentid], references: [id], onDelete: Cascade)
  parentid    String?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @default(now())
  updated     Boolean       @default(false)
  CommentLike CommentLike[]
  replies     Comment[]     @relation("replies")

  Notification Notification[]
}

model PostLike {
  id        String   @id @default(uuid())
  post      Post     @relation(fields: [postid], references: [id], onDelete: Cascade)
  postid    String
  user      User     @relation(fields: [userid], references: [id], onDelete: Cascade)
  userid    String
  createdAt DateTime @default(now())

  @@unique([postid, userid])
}

model CommentLike {
  id        String   @id @default(uuid())
  comment   Comment  @relation(fields: [commentid], references: [id], onDelete: Cascade)
  commentid String
  user      User     @relation(fields: [userid], references: [id], onDelete: Cascade)
  userid    String
  createdAt DateTime @default(now())

  @@unique([commentid, userid])
}

model Notification {
  id          String           @id @default(uuid())
  recipient   User             @relation("RecipientRelation", fields: [recipientid], references: [id], onDelete: Cascade)
  recipientid String
  type        NotificationType
  actor       User             @relation("SenderRelation", fields: [actorId], references: [id], onDelete: Cascade)
  actorId     String
  post        Post?            @relation(fields: [postid], references: [id], onDelete: Cascade)
  postid      String?
  comment     Comment?         @relation(fields: [commentid], references: [id], onDelete: Cascade)
  commentid   String?
  isRead      Boolean          @default(false)
  readAt      DateTime?
  createdAt   DateTime         @default(now())
}

model AiInteraction {
  id           String @id @default(uuid())
  user         User   @relation(fields: [userid], references: [id])
  userid       String
  requestText  String
  response     Json
  model        String
  tokensInput  Int
  tokensOutput Int
}
